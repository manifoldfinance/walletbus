(this["webpackJsonp@securerpc/dashboard"]=this["webpackJsonp@securerpc/dashboard"]||[]).push([[0],{180:function(e,t,n){"use strict";(function(e){var r=n(0),s=n(174).default,c=n(173).default,a=n(175).default,i=n(176).default,o=n(282).default,u=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,c){function a(e){try{o(r.next(e))}catch(t){c(t)}}function i(e){try{o(r.throw(e))}catch(t){c(t)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}o((r=r.apply(e,t||[])).next())}))},d=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageBusPorts=t.connectToMessageBus=t.connectToMessageBusWithRetries=t.sendAndAwait=t.broadcastAndAwaitFirst=t.broadcastAndDisregard=t.createMessage=t.startWebSocketServer=t.base64ToJson=t.jsonToBase64=t.MessageBusConnectionError=void 0;var l=d(n(162)),f=d(n(285)),b=d(n(179)),h=d(n(163));f.default.shim();var v=function(e){a(n,e);var t=i(n);function n(){return c(this,n),t.apply(this,arguments)}return s(n)}(o(Error));t.MessageBusConnectionError=v;t.jsonToBase64=function(t){var n=JSON.stringify(t);return e.from(n).toString("base64")};t.base64ToJson=function(t){var n=e.from(t,"base64").toString("utf8");return JSON.parse(n)};t.startWebSocketServer=function(e){return new Promise((function(t){var n=new l.default.Server(e,(function(){return t(n)}))}))};t.createMessage=function(e,t){return{id:Math.random(),type:e,payload:t}};t.broadcastAndDisregard=function(e,n){var r=(0,t.jsonToBase64)(n);e.forEach((function(e){e.send(r)}))};t.broadcastAndAwaitFirst=function(e,n){return u(void 0,void 0,void 0,r.mark((function s(){var c,a;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return c=e.map((function(e){return(0,t.sendAndAwait)(e,n)})),r.next=3,Promise.any(c);case 3:return a=r.sent,r.abrupt("return",a);case 5:case"end":return r.stop()}}),s)})))};t.sendAndAwait=function(e,n){return new Promise((function(r,s){e.addEventListener("message",(function(e){"string"!==typeof e.data&&(e.data=e.data.toString());var s=(0,t.base64ToJson)(e.data);s.id===n.id&&r(s)})),e.addEventListener("error",(function(e){s(e.error)})),e.addEventListener("close",(function(e){s(new Error("Socket connection closed with code '".concat(e.code,"' and reason '").concat(e.reason,"'")))}));var c=(0,t.jsonToBase64)(n);e.send(c)}))};t.connectToMessageBusWithRetries=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localhost",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return u(void 0,void 0,void 0,r.mark((function c(){var a,i;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:a=new Error,i=0;case 2:if(!(i<s)){r.next=17;break}return r.prev=3,r.next=6,(0,t.connectToMessageBus)(e,n);case 6:return r.abrupt("return",r.sent);case 9:return r.prev=9,r.t0=r.catch(3),a=r.t0,r.next=14,(0,b.default)(1e3);case 14:i+=1,r.next=2;break;case 17:throw a;case 18:case"end":return r.stop()}}),c,null,[[3,9]])})))};t.connectToMessageBus=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localhost",n=new l.default("ws://".concat(t,":").concat(e));return new Promise((function(e,t){n.addEventListener("open",(function(){return e(n)})),n.addEventListener("error",(function(e){return t(e.error)}))}))};t.getMessageBusPorts=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localhost",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return u(void 0,void 0,void 0,r.mark((function s(){var c,a,i;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:c=0;case 1:if(!(c<n)){r.next=17;break}return r.prev=2,r.next=5,h.default.get("http://".concat(t,":").concat(e,"/ports"));case 5:return a=r.sent,i=a.data,r.abrupt("return",i);case 10:return r.prev=10,r.t0=r.catch(2),r.next=14,(0,b.default)(1e3);case 14:c+=1,r.next=1;break;case 17:throw new v("Could not connect to dashboard at http://".concat(t,":").concat(e,"/ports"));case 18:case"end":return r.stop()}}),s,null,[[2,10]])})))}}).call(this,n(122).Buffer)},273:function(e,t,n){"use strict";var r=n(0),s=n(173).default,c=n(174).default,a=n(175).default,i=n(176).default,o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(s,c){function a(e){try{o(r.next(e))}catch(t){c(t)}}function i(e){try{o(r.throw(e))}catch(t){c(t)}}function o(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,i)}o((r=r.apply(e,t||[])).next())}))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DashboardMessageBus=void 0;var d=u(n(179)),l=n(110),f=n(180),b=n(164),h=function(e){a(n,e);var t=i(n);function n(e,r){var c,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"localhost";return s(this,n),(c=t.call(this)).publishPort=e,c.subscribePort=r,c.host=a,c.publishers=[],c.subscribers=[],c.unfulfilledRequests=new Map([]),c}return c(n,[{key:"start",value:function(){return o(this,void 0,void 0,r.mark((function e(){var t=this;return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,f.startWebSocketServer)({host:this.host,port:this.subscribePort});case 2:return this.subscribeServer=e.sent,this.subscribeServer.on("connection",(function(e){e.on("close",(function(){t.removeSubscriber(e)})),e.once("message",(function(){return t.addSubscriber(e)}))})),e.next=6,(0,f.startWebSocketServer)({host:this.host,port:this.publishPort});case 6:this.publishServer=e.sent,this.publishServer.on("connection",(function(e){e.on("close",(function(){t.removePublisher(e)})),t.addPublisher(e)}));case 8:case"end":return e.stop()}}),e,this)})))}},{key:"ready",value:function(){return o(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.subscribers.length){e.next=5;break}return e.next=3,(0,d.default)(1e3);case 3:e.next=0;break;case 5:case"end":return e.stop()}}),e,this)})))}},{key:"terminate",value:function(){return o(this,void 0,void 0,r.mark((function e(){return r.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,b.promisify)(this.publishServer.close.bind(this.publishServer))();case 2:return e.next=4,(0,b.promisify)(this.subscribeServer.close.bind(this.subscribeServer))();case 4:this.emit("terminate");case 5:case"end":return e.stop()}}),e,this)})))}},{key:"processRequest",value:function(e,t,n){return o(this,void 0,void 0,r.mark((function s(){var c,a,i;return r.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return"string"!==typeof t&&(t=t.toString()),r.next=3,this.ready();case 3:return this.unfulfilledRequests.set(t,{publisher:e,data:t}),c=(0,f.base64ToJson)(t),r.prev=5,this.logToPublishers("Sending message to ".concat(n.length," subscribers"),"requests"),this.logToPublishers(c,"requests"),r.next=10,(0,f.broadcastAndAwaitFirst)(n,c);case 10:a=r.sent,this.logToPublishers("Sending response for message ".concat(c.id),"responses"),this.logToPublishers(a,"responses"),i=(0,f.jsonToBase64)(a),e.send(i),this.unfulfilledRequests.delete(t),this.invalidateMessage(c.id),r.next=23;break;case 19:r.prev=19,r.t0=r.catch(5),this.logToPublishers("An error occurred while processing message ".concat(c.id),"errors"),this.logToPublishers(r.t0,"errors");case 23:case"end":return r.stop()}}),s,this,[[5,19]])})))}},{key:"invalidateMessage",value:function(e){var t=(0,f.createMessage)("invalidate",e);(0,f.broadcastAndDisregard)(this.subscribers,t)}},{key:"logToPublishers",value:function(e,t){this.logTo(e,this.publishers,t)}},{key:"logToSubscribers",value:function(e,t){this.logTo(e,this.subscribers,t)}},{key:"logToAll",value:function(e,t){this.logToPublishers(e,t),this.logToSubscribers(e,t)}},{key:"logTo",value:function(e,t,n){var r={namespace:"dashboard-message-bus",message:e};n&&(r.namespace+=":".concat(n));var s=(0,f.createMessage)("log",r);(0,f.broadcastAndDisregard)(t,s)}},{key:"addSubscriber",value:function(e){var t=this;this.unfulfilledRequests.forEach((function(n){var r=n.publisher,s=n.data;return t.processRequest(r,s,[e])})),this.logToPublishers("Subscriber connected","connections"),this.subscribers.push(e)}},{key:"removeSubscriber",value:function(e){this.logToPublishers("Subscriber disconnected","connections"),this.subscribers=this.subscribers.filter((function(t){return t!==e})),this.terminateIfNoConnections()}},{key:"addPublisher",value:function(e){var t=this;this.logToPublishers("Publisher connected","connections"),e.on("message",(function(n){t.processRequest(e,n,t.subscribers)})),this.publishers.push(e)}},{key:"removePublisher",value:function(e){this.logToPublishers("Publisher disconnected","connections"),this.publishers=this.publishers.filter((function(t){return t!==e})),this.clearRequestsForPublisher(e),this.terminateIfNoConnections()}},{key:"terminateIfNoConnections",value:function(){0===this.publishers.length&&0===this.subscribers.length&&this.terminate()}},{key:"clearRequestsForPublisher",value:function(e){var t=this;this.unfulfilledRequests.forEach((function(n,r){n.publisher===e&&t.unfulfilledRequests.delete(r)}))}}]),n}(l.EventEmitter);t.DashboardMessageBus=h},308:function(e,t){},367:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(368),t)},368:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isInvalidateMessage=t.isDebugMessage=t.isLogMessage=t.isDashboardProviderMessage=void 0;t.isDashboardProviderMessage=function(e){return"provider"===e.type};t.isLogMessage=function(e){return"log"===e.type};t.isDebugMessage=function(e){return"debug"===e.type};t.isInvalidateMessage=function(e){return"invalidate"===e.type}},370:function(e,t){},381:function(e,t){},382:function(e,t){},383:function(e,t){},385:function(e,t){},386:function(e,t){},389:function(e,t){},426:function(e,t,n){},427:function(e,t,n){"use strict";n.r(t);var r=n(15),s=n.n(r),c=n(241),a=n.n(c),i=n(30),o=n(11),u=n(242),d=n(19),l=n(0),f=n.n(l),b=n(71),h=n(162),v=n.n(h),p=n(163),j=n.n(p),g=n(164),x=["eth_signTransaction","eth_sendTransaction","eth_decrypt","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign"],O=["eth_sign"],m=function(){var e=Object(o.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=window.location.hostname,n=Number(window.location.port),e.abrupt("return",Object(b.getMessageBusPorts)(n,t));case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(e){return x.includes(e.payload.method)},w=function(e){return O.includes(e.payload.method)},_=function(){var e=Object(o.a)(f.a.mark((function e(t,n,r){var s,c,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("forwardDashboardProviderRequest:input",{id:r.id,provider:t,connector:n,payload:r}),s=Object(g.promisify)(t.sendAsync.bind(t)),e.prev=2,e.next=5,s(r);case 5:if(c=e.sent,a=null===n||void 0===n?void 0:n.id,console.debug("forwardDashboardProviderRequest:result",{id:r.id,payload:r,result:c}),"injected"!==a){e.next=12;break}return e.abrupt("return",c);case 12:return e.abrupt("return",{jsonrpc:r.jsonrpc,id:r.id,result:c});case 13:e.next=19;break;case 15:return e.prev=15,e.t0=e.catch(2),console.error(e.t0),e.abrupt("return",{jsonrpc:r.jsonrpc,id:r.id,error:e.t0});case 19:case"end":return e.stop()}}),e,null,[[2,15]])})));return function(t,n,r){return e.apply(this,arguments)}}(),P=function(){var e=Object(o.a)(f.a.mark((function e(t,n,r,s){var c,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,_(n,r,t.payload);case 2:c=e.sent,a={id:t.id,payload:c},k(a,s);case 5:case"end":return e.stop()}}),e)})));return function(t,n,r,s){return e.apply(this,arguments)}}(),k=function(e,t){console.debug("Sending response",e);var n=Object(b.jsonToBase64)(e);t.send(n)},S=function(){var e=Object(o.a)(f.a.mark((function e(t){var n,r,s,c,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.get("https://chainid.network/chains.json");case 2:if(n=e.sent,r=n.data,s=r.filter((function(e){return e.chainId===t})),c=Object(d.a)(s,1),a=c[0]){e.next=7;break}return e.abrupt("return","Chain ID ".concat(t));case 7:return e.abrupt("return",a.name);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=Object(o.a)(f.a.mark((function e(t,n){var r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,M(t,n);case 2:return r=e.sent,s=N(n),e.abrupt("return",null!==r&&void 0!==r?r:s);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),M=function(){var e=Object(o.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.lookupAddress(n);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",void 0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t,n){return e.apply(this,arguments)}}(),N=function(e){return"".concat(e.slice(0,6),"...").concat(e.slice(-4))},E=n(14);var D=function(e){var t=e.chainId,n=Object(r.useState)("Chain ID ".concat(t)),s=Object(d.a)(n,2),c=s[0],a=s[1],i=1===t?"text-truffle-red":"";return Object(r.useEffect)((function(){var e=function(){var e=Object(o.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S(t);case 2:n=e.sent,a(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();t&&e(t)}),[t]),Object(E.jsx)("div",{className:"rounded uppercase ".concat(i),children:c})},R=n(45);var C=function(e){var t=e.disabled,n=e.onClick,r=e.text;return Object(E.jsx)("button",{disabled:t,className:"rounded p-4 mx-2 bg-truffle-blue text-truffle-brown uppercase hover:bg-white",onClick:n,children:r})};var A=function(e){var t,n,s=e.disconnect,c=Object(r.useState)(),a=Object(d.a)(c,2),i=a[0],u=a[1],l=Object(R.b)(),b=Object(d.a)(l,1)[0].data,h=Object(R.d)(),v=Object(d.a)(h,1)[0].data,p=Object(R.c)(),j=Object(d.a)(p,1)[0].data;return Object(r.useEffect)((function(){var e,t=function(){var e=Object(o.a)(f.a.mark((function e(t,n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=u,e.next=3,T(t,n);case 3:e.t1=e.sent,(0,e.t0)(e.t1);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();j.connected||u(void 0),j&&b&&t(null===(e=j.connector)||void 0===e?void 0:e.getProvider(),b.address)}),[j,b]),Object(E.jsxs)("header",{className:"grid grid-cols-2 py-2 px-4 border-b-2 border-truffle-light text-md uppercase",children:[Object(E.jsx)("div",{className:"flex justify-start items-center",children:Object(E.jsxs)("span",{className:"inline-flex items-center gap-3",children:[Object(E.jsx)("img",{src:"/favicon-32x32.png",width:"32px",alt:"Manifold Finance Logo"}),"Walletbus Dashboard"]})}),Object(E.jsxs)("div",{className:"flex justify-end items-center gap-4 text-md",children:[(null===(t=v.chain)||void 0===t?void 0:t.id)&&Object(E.jsx)(D,{chainId:v.chain.id}),(null===(n=v.chain)||void 0===n?void 0:n.id)&&Object(E.jsx)(C,{onClick:s,text:"disconnect"}),Object(E.jsx)("div",{children:i})]})]})};var I=function(e){var t=e.header,n=e.body,r=e.footer,s=t&&Object(E.jsx)("div",{className:"border-b border-grey py-3 mx-3",children:Object(E.jsx)("h2",{className:"text-center uppercase",children:t})}),c=n&&Object(E.jsx)("div",{className:"p-3 overflow-auto",children:n}),a=r&&Object(E.jsx)("div",{className:"border-t border-grey py-3 mx-3",children:r});return Object(E.jsxs)("div",{className:"border-grey border rounded bg-white w-full",children:[s,c,a]})},q=n(118),B=n.n(q);var W=function(e){var t=e.provider,n=e.connector,s=e.socket,c=e.request,a=e.setRequests,i=Object(r.useState)(!1),u=Object(d.a)(i,2),l=u[0],b=u[1],h=function(){a((function(e){return e.filter((function(e){return e.id!==c.id}))}))},v=function(){var e=Object(o.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(c,t,n,s);case 2:h();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(o.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t={id:c.id,payload:{jsonrpc:c.payload.jsonrpc,id:c.payload.id,error:{code:4001,message:"User rejected walletbus request"}}},k(t,s),h();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=Object(E.jsx)("div",{className:"normal-case",children:c.payload.method}),g=Object(E.jsx)("div",{children:function(e){switch(e.payload.method){case"eth_sendTransaction":case"eth_signTransaction":var t=Object(d.a)(e.payload.params,1)[0];return Object(E.jsx)(B.a,{name:"transaction",src:t});case"eth_signTypedData_v1":case"eth_signTypedData":var n=Object(d.a)(e.payload.params,2),r=n[0],s=n[1];return Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{children:["Account: ",s]}),Object(E.jsxs)("div",{className:"flex gap-2",children:[Object(E.jsx)("div",{children:"Message:"}),Object(E.jsx)(B.a,{name:"message params",src:r})]})]});case"eth_signTypedData_v3":case"eth_signTypedData_v4":var c=Object(d.a)(e.payload.params,2),a=c[0],i=c[1],o=JSON.parse(i).message;return Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{children:["Account: ",a]}),Object(E.jsxs)("div",{className:"flex gap-2",children:[Object(E.jsx)("div",{children:"Message:"}),Object(E.jsx)(B.a,{name:"message",src:o})]})]});case"personal_sign":var u=Object(d.a)(e.payload.params,2),l=u[0],f=u[1];return Object(E.jsxs)("div",{children:[Object(E.jsxs)("div",{children:["Account: ",f]}),Object(E.jsxs)("div",{className:"flex gap-2",children:[Object(E.jsx)("div",{children:"Message:"}),Object(E.jsx)("div",{children:l})]})]});default:return Object(E.jsx)(B.a,{src:e.payload.params})}}(c)}),x=l?Object(E.jsx)("div",{className:"flex justify-start items-center gap-2",children:Object(E.jsx)(C,{disabled:!0,onClick:function(){},text:"Processing..."})}):Object(E.jsxs)("div",{className:"flex justify-start items-center gap-2",children:[Object(E.jsx)(C,{onClick:function(){v(),b(!0)},text:"Process"}),Object(E.jsx)(C,{onClick:p,text:"Reject"})]});return Object(E.jsx)("div",{className:"flex justify-center items-center",children:Object(E.jsx)(I,{header:j,body:g,footer:x})},c.id)};var F=function(e){var t,n=e.paused,s=e.socket,c=e.requests,a=e.setRequests,i=Object(R.c)(),o=Object(d.a)(i,1)[0].data,u=null===(t=o.connector)||void 0===t?void 0:t.getProvider(),l=o.connector;Object(r.useEffect)((function(){var e=function(e){a((function(t){return t.filter((function(t){return t.id!==e}))}))};o.connected&&u&&(n||(c.filter(w).forEach((function(t){!function(e,t){var n,r='Method "'.concat(e.payload.method,'" is unsupported by walletbus'),s=null!==(n={eth_sign:'Method "eth_sign" is unsupported by walletbus, please use "personal_sign" instead'}[e.payload.method])&&void 0!==n?n:r,c={id:e.id,payload:{jsonrpc:e.payload.jsonrpc,id:e.payload.id,error:{code:4001,message:s}}};k(c,t)}(t,s),e(t.id)})),c.filter((function(e){return!y(e)&&!w(e)})).forEach((function(t){P(t,u,l,s),e(t.id)}))))}),[n,c,a,s,o,u,l]);var f=o.connected&&u&&s?c.filter(y).map((function(e){return Object(E.jsx)(W,{request:e,setRequests:a,provider:u,connector:l,socket:s},e.id)})):[];return Object(E.jsx)("div",{className:"flex justify-center items-center py-20",children:Object(E.jsx)("div",{className:"mx-3 w-3/4 max-w-4xl h-2/3",children:Object(E.jsx)(I,{header:"Incoming Requests",body:f})})})};var L=function(e){var t,n=e.confirm,r=Object(R.c)(),s=Object(d.a)(r,2),c=s[0].data,a=s[1],i=Object(R.d)(),o=null===(t=Object(d.a)(i,1)[0].data.chain)||void 0===t?void 0:t.id,u=Object(E.jsx)("div",{children:c.connectors.map((function(e){return Object(E.jsx)(C,{onClick:function(){return a(e)},text:e.name},e.id)}))}),l=o&&Object(E.jsxs)("div",{className:"flex flex-col gap-2",children:[Object(E.jsx)("div",{children:"Please confirm you're connected to the right network (or switch to the right one) before continuing."}),Object(E.jsx)("div",{className:"flex justify-center",children:Object(E.jsx)(D,{chainId:o})})]}),f=Object(E.jsx)(C,{text:"Confirm",onClick:n});return Object(E.jsx)("div",{className:"flex justify-center items-center py-20",children:Object(E.jsx)("div",{className:"mx-3 w-3/4 max-w-4xl h-2/3 text-center",children:void 0===o?Object(E.jsx)(I,{header:"Connect Wallet",body:"Please connect your wallet to use the Walletbus Dashboard Provider.",footer:u}):Object(E.jsx)(I,{header:"Connect Wallet",body:l,footer:f})})})};var J=function(e){var t=e.confirm,n=e.newChainId,r=e.previousChainId,s=Object(E.jsxs)("div",{className:"flex flex-col gap-2",children:[Object(E.jsx)("div",{children:"We detected that your connected network changed. Please confirm that this was your intention or switch back to the previous network."}),Object(E.jsx)("div",{children:"Your previous connected network was:"}),Object(E.jsx)("div",{className:"flex justify-center",children:Object(E.jsx)(D,{chainId:r})}),Object(E.jsx)("div",{children:"Your new connected network is:"}),Object(E.jsx)("div",{className:"flex justify-center",children:Object(E.jsx)(D,{chainId:n})})]}),c=Object(E.jsx)(C,{text:"Confirm",onClick:t});return Object(E.jsx)("div",{className:"flex justify-center items-center py-20",children:Object(E.jsx)("div",{className:"mx-3 w-3/4 max-w-4xl h-2/3 text-center",children:Object(E.jsx)(I,{header:"Confirm Network Changed",body:s,footer:c})})})};var U=function(){var e=Object(r.useState)(!1),t=Object(d.a)(e,2),n=t[0],s=t[1],c=Object(r.useState)(),a=Object(d.a)(c,2),l=a[0],h=a[1],p=Object(r.useState)(),j=Object(d.a)(p,2),g=j[0],x=j[1],O=Object(r.useState)(),y=Object(d.a)(O,2),w=y[0],_=y[1],P=Object(r.useState)([]),S=Object(d.a)(P,2),T=S[0],M=S[1],N=Object(R.d)(),D=Object(d.a)(N,1)[0].data,C=Object(R.b)(),I=Object(d.a)(C,2);Object(u.a)(I[0]);var q=I[1],B=Object(R.c)(),W=Object(d.a)(B,1)[0].data;Object(r.useEffect)((function(){x(g),g&&w&&(l?(l!==g&&s(!0),l===g&&s(!1)):h(g))}),[D,W,w,g,l]);var U=function(){var e=Object(o.a)(f.a.mark((function e(){var t,n,r,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!w||w.readyState!==v.a.OPEN){e.next=2;break}return e.abrupt("return");case 2:return t=window.location.hostname,e.next=5,m();case 5:return n=e.sent,r=n.subscribePort,e.next=9,Object(b.connectToMessageBusWithRetries)(r,t);case 9:(s=e.sent).addEventListener("message",(function(e){"string"!==typeof e.data&&(e.data=e.data.toString());var t=Object(b.base64ToJson)(e.data);if(console.debug("Received message",t),Object(b.isDashboardProviderMessage)(t))M((function(e){return[].concat(Object(i.a)(e),[t])}));else if(Object(b.isInvalidateMessage)(t))M((function(e){return e.filter((function(e){return e.id!==t.payload}))}));else if(Object(b.isDebugMessage)(t)){var n=t.payload;console.log(n.message),k({id:t.id},s)}})),s.send("ready"),_(s);case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(E.jsxs)("div",{className:"h-full min-h-screen bg-gradient-to-b from-truffle-lighter to-truffle-light",children:[Object(E.jsx)(A,{disconnect:function(){console.log("Disconnecting:"),q(),h(void 0),s(!1),null===w||void 0===w||w.close(),_(void 0)}}),n&&g&&l&&Object(E.jsx)(J,{newChainId:g,previousChainId:l,confirm:function(){return h(g)}}),!n&&!w&&Object(E.jsx)(L,{confirm:U}),!n&&w&&Object(E.jsx)(F,{paused:n,socket:w,requests:T,setRequests:M})]})},H=n(18),K=n(251),V=n(260),Y=n(63),z=n(64),G=n(114),Q=H.n.mainnet,X=function(e){var t,n,r,s=null===(t=e.connector)||void 0===t?void 0:t.getProvider(!0);(console.debug("getProvider",{wProvider:s,winEth:window.ethereum,_config:e,INFURA_ID:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.3.0"}).REACT_APP_INFURA_ID}),s)?(s.enable().then((function(e){return console.debug(e)})).catch((function(e){return console.error(e)})),n=new z.providers.Web3Provider(s)):n=Object(Y.getDefaultProvider)(Object(G.a)(null!==(r=e.chainId)&&void 0!==r?r:Q.id));return console.debug("getProvider.returning",{wProvider:s,winEth:window.ethereum,ret:n}),n},Z=[new K.a({chains:H.l}),new V.a({chains:H.l,options:{infuraId:Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_VERSION:"0.3.0"}).REACT_APP_INFURA_ID,qrcode:!0}})];var $=function(){return Object(E.jsx)(R.a,{connectors:Z,provider:X,children:Object(E.jsx)(U,{})})};n(426);a.a.render(Object(E.jsx)(s.a.StrictMode,{children:Object(E.jsx)($,{})}),document.getElementById("root"))},71:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var s=Object.getOwnPropertyDescriptor(t,n);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,s)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),s(n(273),t),s(n(180),t),s(n(367),t)}},[[427,1,2]]]);
//# sourceMappingURL=main.ae4bf9b9.chunk.js.map