(this["webpackJsonp@securerpc/dashboard"]=this["webpackJsonp@securerpc/dashboard"]||[]).push([[0],{127:function(e,t){},16:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),n=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(s(99),t),n(s(53),t),n(s(186),t),n(s(83),t)},186:function(e,t,s){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,s,r){void 0===r&&(r=s);var n=Object.getOwnPropertyDescriptor(t,s);n&&!("get"in n?!t.__esModule:n.writable||n.configurable)||(n={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,r,n)}:function(e,t,s,r){void 0===r&&(r=s),e[r]=t[s]}),n=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||r(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),n(s(83),t)},188:function(e,t){},198:function(e,t,s){},199:function(e,t,s){"use strict";s.r(t);var r=s(5),n=s.n(r),i=s(87),o=s.n(i),c=s(16),a=s(49),d=s.n(a),l=s(205),u=s(50);const h=["eth_signTransaction","eth_sendTransaction","eth_decrypt","eth_signTypedData","eth_signTypedData_v1","eth_signTypedData_v3","eth_signTypedData_v4","personal_sign"],b=["eth_sign"],j=e=>h.includes(e.payload.method),f=e=>b.includes(e.payload.method),p=async(e,t,s)=>{const r=await(async(e,t)=>{const s=Object(u.promisify)(e.sendAsync.bind(e));try{return await s(t)}catch(r){return{jsonrpc:t.jsonrpc,id:t.id,error:r}}})(t,e.payload),n={id:e.id,payload:r};v(n,s)},v=(e,t)=>{console.debug("Sending response",e);const s=Object(c.jsonToBase64)(e);t.send(s)},g=e=>new l.a.Web3Provider(e),m=async(e,t)=>{try{return await e.lookupAddress(t)}catch{return}},y=e=>"".concat(e.substr(0,6),"...").concat(e.substr(e.length-4,4));var x=s(15),O=s(48),w=s.n(O),_=s(2);var P=function(e){let{chainId:t}=e;const[s,n]=Object(r.useState)("Chain ID ".concat(t)),i=1===t?"text-dashboard-red":"";return Object(r.useEffect)((()=>{t&&(async e=>{const t=await(async e=>{const{data:t}=await d.a.get("https://chainid.network/chains.json"),[s]=t.filter((t=>t.chainId===e));return s?s.name:"Chain ID ".concat(e)})(e);n(t),console.log(t)})(t)}),[t]),Object(_.jsx)("div",{className:"rounded uppercase ".concat(i),children:s})};var S=function(e){let{}=e;const[t,s]=Object(r.useState)(),{account:n,library:i,chainId:o}=Object(x.b)();return Object(r.useEffect)((()=>{i&&n&&(async(e,t)=>{s(await(async(e,t)=>{const s=await m(e,t),r=y(t);return null!==s&&void 0!==s?s:r})(e,t))})(i,n)}),[i,n]),Object(_.jsxs)("header",{className:"grid grid-cols-2 py-2 px-4 border-b-2 border-dashboard-light text-md uppercase",children:[Object(_.jsx)("div",{className:"flex justify-start items-center",children:Object(_.jsxs)("span",{className:"inline-flex items-center gap-3",children:[Object(_.jsx)("img",{src:"/logomark.svg",width:"32px"}),"Wallet Bus"]})}),Object(_.jsxs)("div",{className:"flex justify-end items-center gap-4 text-md",children:[o&&Object(_.jsx)(P,{chainId:o}),Object(_.jsx)("div",{children:t})]})]})};var T=function(e){let{header:t,body:s,footer:r}=e;const n=t&&Object(_.jsx)("div",{className:"border-b border-grey py-3 mx-3",children:Object(_.jsx)("h2",{className:"text-center uppercase",children:t})}),i=s&&Object(_.jsx)("div",{className:"p-3 overflow-auto",children:s}),o=r&&Object(_.jsx)("div",{className:"border-t border-grey py-3 mx-3",children:r});return Object(_.jsxs)("div",{className:"border-grey border rounded bg-white w-full",children:[n,i,o]})},M=s(23),N=s.n(M);var k=function(e){let{onClick:t,text:s}=e;return Object(_.jsx)("button",{className:"rounded p-2 bg-dashboard-blue text-dashboard-brown uppercase hover:bg-white",onClick:t,children:s})};var D=function(e){let{provider:t,socket:s,request:r,setRequests:n}=e;const i=()=>{n((e=>e.filter((e=>e.id!==r.id))))},o=Object(_.jsx)("div",{className:"normal-case",children:r.payload.method}),c=Object(_.jsx)("div",{children:(e=>{switch(e.payload.method){case"eth_sendTransaction":case"eth_signTransaction":{const[t]=e.payload.params;return Object(_.jsx)(N.a,{name:"transaction",src:t})}case"eth_signTypedData_v1":case"eth_signTypedData":{const[t,s]=e.payload.params;return Object(_.jsxs)("div",{children:[Object(_.jsxs)("div",{children:["Account: ",s]}),Object(_.jsxs)("div",{className:"flex gap-2",children:[Object(_.jsx)("div",{children:"Message:"}),Object(_.jsx)(N.a,{name:"message params",src:t})]})]})}case"eth_signTypedData_v3":case"eth_signTypedData_v4":{const[t,s]=e.payload.params,{message:r}=JSON.parse(s);return Object(_.jsxs)("div",{children:[Object(_.jsxs)("div",{children:["Account: ",t]}),Object(_.jsxs)("div",{className:"flex gap-2",children:[Object(_.jsx)("div",{children:"Message:"}),Object(_.jsx)(N.a,{name:"message",src:r})]})]})}case"personal_sign":{const[t,s]=e.payload.params;return Object(_.jsxs)("div",{children:[Object(_.jsxs)("div",{children:["Account: ",s]}),Object(_.jsxs)("div",{className:"flex gap-2",children:[Object(_.jsx)("div",{children:"Message:"}),Object(_.jsx)("div",{children:t})]})]})}default:return Object(_.jsx)(N.a,{src:e.payload.params})}})(r)}),a=Object(_.jsxs)("div",{className:"flex justify-start items-center gap-2",children:[Object(_.jsx)(k,{onClick:async()=>{await p(r,t,s),i()},text:"Process"}),Object(_.jsx)(k,{onClick:async()=>{const e={id:r.id,payload:{jsonrpc:r.payload.jsonrpc,id:r.payload.id,error:{code:4001,message:"User rejected @securerpcwalletbus-provider request"}}};v(e,s),i()},text:"Reject"})]});return Object(_.jsx)("div",{className:"flex justify-center items-center",children:Object(_.jsx)(T,{header:o,body:c,footer:a})},r.id)};var I=function(e){let{paused:t,socket:s,requests:n,setRequests:i}=e;const{account:o,library:c}=Object(x.b)();Object(r.useEffect)((()=>{const e=e=>{i((t=>t.filter((t=>t.id!==e))))};o&&c&&(t||(n.filter(f).forEach((t=>{((e,t)=>{var s;const r='Method "'.concat(e.payload.method,'" is unsupported by @securerpcwalletbus-provider'),n=null!==(s={eth_sign:'Method "eth_sign" is unsupported by @securerpcwalletbus-provider, please use "personal_sign" instead'}[e.payload.method])&&void 0!==s?s:r,i={id:e.id,payload:{jsonrpc:e.payload.jsonrpc,id:e.payload.id,error:{code:4001,message:n}}};v(i,t)})(t,s),e(t.id)})),n.filter((e=>!j(e)&&!f(e))).forEach((t=>{p(t,c.provider,s),e(t.id)}))))}),[t,n,i,s,o,c]);const a=o&&c&&s?n.filter(j).map((e=>Object(_.jsx)(D,{request:e,setRequests:i,provider:c.provider,socket:s}))):[];return Object(_.jsx)("div",{className:"flex justify-center items-center py-20",children:Object(_.jsx)("div",{className:"mx-3 w-3/4 max-w-4xl h-2/3",children:Object(_.jsx)(T,{header:"\ud83c\udf10 Incoming Requests",body:a})})})},R=s(90);var q=function(e){let{confirm:t}=e;const{chainId:s,activate:r}=Object(x.b)(),n=new R.a({}),i=Object(_.jsx)(k,{text:"Connect Wallet",onClick:()=>r(n)}),o=s&&Object(_.jsxs)("div",{className:"flex flex-col gap-2",children:[Object(_.jsx)("div",{children:"Please confirm you're connected to the right network (or switch to the right one) before continuing."}),Object(_.jsx)("div",{className:"flex justify-center",children:Object(_.jsx)(P,{chainId:s})})]}),c=Object(_.jsx)(k,{text:"Confirm",onClick:t});return Object(_.jsx)("div",{className:"flex justify-center items-center py-20",children:Object(_.jsx)("div",{className:"mx-3 w-3/4 max-w-4xl h-2/3 text-center",children:void 0===s?Object(_.jsx)(T,{header:"Connect Wallet",body:"Please connect your wallet to use the Dashboard Provider.",footer:i}):Object(_.jsx)(T,{header:"Connect Wallet",body:o,footer:c})})})};var A=function(e){let{confirm:t,newChainId:s,previousChainId:r}=e;const n=Object(_.jsxs)("div",{className:"flex flex-col gap-2",children:[Object(_.jsx)("div",{children:"\ud83c\udf10 We detected that your connected network changed. Please confirm that this was your intention or switch back to the previous network."}),Object(_.jsx)("div",{children:"Your previous connected network was:"}),Object(_.jsx)("div",{className:"flex justify-center",children:Object(_.jsx)(P,{chainId:r})}),Object(_.jsx)("div",{children:" \ud83d\udfe2 Your new connected network is:"}),Object(_.jsx)("div",{className:"flex justify-center",children:Object(_.jsx)(P,{chainId:s})})]}),i=Object(_.jsx)(k,{text:"\u2705 Confirm",onClick:t});return Object(_.jsx)("div",{className:"flex justify-center items-center py-20",children:Object(_.jsx)("div",{className:"mx-3 w-3/4 max-w-4xl h-2/3 text-center",children:Object(_.jsx)(T,{header:"Confirm Network Changed",body:n,footer:i})})})};var C=function(){const[e,t]=Object(r.useState)(!1),[s,n]=Object(r.useState)(),[i,o]=Object(r.useState)(),[a,d]=Object(r.useState)([]),{chainId:l}=Object(x.b)();return console.log({chainId:l}),Object(r.useEffect)((()=>{l&&i&&(s?(s!==l&&t(!0),s===l&&t(!1)):n(l))}),[l,s,i]),Object(_.jsxs)("div",{className:"h-full min-h-screen bg-gradient-to-b from-dashboard-lighter to-dashboard-light",children:[Object(_.jsx)(S,{}),e&&l&&s&&Object(_.jsx)(A,{newChainId:l,previousChainId:s,confirm:()=>n(l)}),!e&&!i&&Object(_.jsx)(q,{confirm:async()=>{if(i&&i.readyState===w.a.OPEN)return;const e=window.location.hostname,{subscribePort:t}=await(async()=>{const e=window.location.hostname,t=Number(window.location.port);return Object(c.getMessageBusPorts)(t,e)})(),s=await Object(c.connectToMessageBusWithRetries)(t,e);s.addEventListener("message",(e=>{"string"!==typeof e.data&&(e.data=e.data.toString());const t=Object(c.base64ToJson)(e.data);console.debug("Received message",t),Object(c.isDashboardProviderMessage)(t)?d((e=>[...e,t])):Object(c.isInvalidateMessage)(t)&&d((e=>e.filter((e=>e.id!==t.payload))))})),s.send("ready"),o(s)}}),!e&&i&&Object(_.jsx)(I,{paused:e,socket:i,requests:a,setRequests:d})]})};var E=function(){return Object(_.jsx)(x.a,{getLibrary:g,children:Object(_.jsx)(C,{})})};s(198);o.a.render(Object(_.jsx)(n.a.StrictMode,{children:Object(_.jsx)(E,{})}),document.getElementById("root"))},53:function(e,t,s){"use strict";(function(e){var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function o(e){try{a(r.next(e))}catch(t){i(t)}}function c(e){try{a(r.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,c)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageBusPorts=t.connectToMessageBus=t.connectToMessageBusWithRetries=t.sendAndAwait=t.broadcastAndAwaitFirst=t.broadcastAndDisregard=t.createMessage=t.startWebSocketServer=t.base64ToJson=t.jsonToBase64=void 0;const i=n(s(48)),o=n(s(104)),c=n(s(52)),a=n(s(49));o.default.shim();t.jsonToBase64=t=>{const s=JSON.stringify(t);return e.from(s).toString("base64")};t.base64ToJson=t=>{const s=e.from(t,"base64").toString("utf8");return JSON.parse(s)};t.startWebSocketServer=e=>new Promise((t=>{const s=new i.default.Server(e,(()=>t(s)))}));t.createMessage=(e,t)=>({id:Math.random(),type:e,payload:t});t.broadcastAndDisregard=(e,s)=>{const r=(0,t.jsonToBase64)(s);e.forEach((e=>{e.send(r)}))};t.broadcastAndAwaitFirst=(e,s)=>r(void 0,void 0,void 0,(function*(){const r=e.map((e=>(0,t.sendAndAwait)(e,s)));return yield Promise.any(r)}));t.sendAndAwait=(e,s)=>new Promise(((r,n)=>{e.addEventListener("message",(e=>{"string"!==typeof e.data&&(e.data=e.data.toString());const n=(0,t.base64ToJson)(e.data);n.id===s.id&&r(n)})),e.addEventListener("error",(e=>{n(e.error)})),e.addEventListener("close",(e=>{n(new Error("Socket connection closed with code '".concat(e.code,"' and reason '").concat(e.reason,"'")))}));const i=(0,t.jsonToBase64)(s);e.send(i)}));t.connectToMessageBusWithRetries=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8564,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localhost",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:50;return r(void 0,void 0,void 0,(function*(){let r=new Error;for(let o=0;o<n;o+=1)try{return yield(0,t.connectToMessageBus)(e,s)}catch(i){r=i,yield(0,c.default)(1e3)}throw r}))};t.connectToMessageBus=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8564,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localhost";const s=new i.default("ws://".concat(t,":").concat(e));return new Promise(((e,t)=>{s.addEventListener("open",(()=>e(s))),s.addEventListener("error",(e=>t(e.error)))}))};t.getMessageBusPorts=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8564,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"localhost",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;return r(void 0,void 0,void 0,(function*(){for(let n=0;n<s;n+=1)try{const{data:s}=yield a.default.get("http://".concat(t,":").concat(e,"/ports"));return s}catch(r){yield(0,c.default)(1e3)}throw new Error("[ERROR]: Unable to connect to dashboard at http://".concat(t,":").concat(e,"/ports"))}))}}).call(this,s(100).Buffer)},83:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isInvalidateMessage=t.isLogMessage=t.isDashboardProviderMessage=void 0;t.isDashboardProviderMessage=e=>"provider"===e.type;t.isLogMessage=e=>"log"===e.type;t.isInvalidateMessage=e=>"invalidate"===e.type},99:function(e,t,s){"use strict";var r=this&&this.__awaiter||function(e,t,s,r){return new(s||(s=Promise))((function(n,i){function o(e){try{a(r.next(e))}catch(t){i(t)}}function c(e){try{a(r.throw(e))}catch(t){i(t)}}function a(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,c)}a((r=r.apply(e,t||[])).next())}))},n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DashboardMessageBus=void 0;const i=n(s(52)),o=s(47),c=s(53),a=s(50);class d extends o.EventEmitter{constructor(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"localhost";super(),this.publishPort=e,this.subscribePort=t,this.host=s,this.publishers=[],this.subscribers=[],this.unfulfilledRequests=new Map([])}start(){return r(this,void 0,void 0,(function*(){this.subscribeServer=yield(0,c.startWebSocketServer)({host:this.host,port:this.subscribePort}),this.subscribeServer.on("connection",(e=>{e.on("close",(()=>{this.removeSubscriber(e)})),e.once("message",(()=>this.addSubscriber(e)))})),this.publishServer=yield(0,c.startWebSocketServer)({host:this.host,port:this.publishPort}),this.publishServer.on("connection",(e=>{e.on("close",(()=>{this.removePublisher(e)})),this.addPublisher(e)}))}))}ready(){return r(this,void 0,void 0,(function*(){for(;0===this.subscribers.length;)yield(0,i.default)(1e3)}))}terminate(){return r(this,void 0,void 0,(function*(){yield(0,a.promisify)(this.publishServer.close.bind(this.publishServer))(),yield(0,a.promisify)(this.subscribeServer.close.bind(this.subscribeServer))(),this.emit("terminate")}))}processRequest(e,t,s){return r(this,void 0,void 0,(function*(){"string"!==typeof t&&(t=t.toString()),yield this.ready(),this.unfulfilledRequests.set(t,{publisher:e,data:t});const r=(0,c.base64ToJson)(t);try{this.logToPublishers("Sending message to ".concat(s.length," subscribers"),"requests"),this.logToPublishers(r,"requests");const n=yield(0,c.broadcastAndAwaitFirst)(s,r);this.logToPublishers("Sending response for message ".concat(r.id),"responses"),this.logToPublishers(n,"responses");const i=(0,c.jsonToBase64)(n);e.send(i),this.unfulfilledRequests.delete(t),this.invalidateMessage(r.id)}catch(n){this.logToPublishers("An error occurred while processing message ".concat(r.id),"errors"),this.logToPublishers(n,"errors")}}))}invalidateMessage(e){const t=(0,c.createMessage)("invalidate",e);(0,c.broadcastAndDisregard)(this.subscribers,t)}logToPublishers(e,t){this.logTo(e,this.publishers,t)}logToSubscribers(e,t){this.logTo(e,this.subscribers,t)}logToAll(e,t){this.logToPublishers(e,t),this.logToSubscribers(e,t)}logTo(e,t,s){const r={namespace:"dashboard-message-bus",message:e};s&&(r.namespace+=":".concat(s));const n=(0,c.createMessage)("log",r);(0,c.broadcastAndDisregard)(t,n)}addSubscriber(e){this.unfulfilledRequests.forEach((t=>{let{publisher:s,data:r}=t;return this.processRequest(s,r,[e])})),this.logToPublishers("Subscriber connected","connections"),this.subscribers.push(e)}removeSubscriber(e){this.logToPublishers("Subscriber disconnected","connections"),this.subscribers=this.subscribers.filter((t=>t!==e)),this.terminateIfNoConnections()}addPublisher(e){this.logToPublishers("Publisher connected","connections"),e.on("message",(t=>{this.processRequest(e,t,this.subscribers)})),this.publishers.push(e)}removePublisher(e){this.logToPublishers("Publisher disconnected","connections"),this.publishers=this.publishers.filter((t=>t!==e)),this.clearRequestsForPublisher(e),this.terminateIfNoConnections()}terminateIfNoConnections(){0===this.publishers.length&&0===this.subscribers.length&&this.terminate()}clearRequestsForPublisher(e){this.unfulfilledRequests.forEach(((t,s)=>{let{publisher:r}=t;r===e&&this.unfulfilledRequests.delete(s)}))}}t.DashboardMessageBus=d}},[[199,1,2]]]);
//# sourceMappingURL=main.5ac653b8.chunk.js.map